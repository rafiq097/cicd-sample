name: Sample CI

on:
  push:
    branches: ["master", "main", "test"]

  pull_request:

jobs:
  backend:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Install Backend Dependencies
        run: cd backend && npm i

      - name: Run Backend Tests
        run: cd backend && npm run test

  frontend:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Install Frontend Dependencies
        run: cd frontend && npm i

      - name: Run Frontend Tests
        run: cd frontend && npm run test

      - name: Build Frontend
        run: cd frontend && npm run build

  test-api:
    runs-on: ubuntu-latest
    needs: [backend, frontend]

    steps:
      - uses: actions/checkout@v3

      # Backend
      - name: Start Backend Server
        run: |
          cd backend
          nohup npm start &
          sleep 10
          echo "Backend server started"

      - name: Test Backend API
        run: |
          curl -f http://localhost:5000 || (echo "Backend API test failed" && exit 1)
          echo "Backend API is working!"

      # Frontend
      - name: Start Frontend Server
        run: |
          cd frontend
          nohup npm run dev &
          sleep 10
          echo "Frontend server started"

      - name: Test Frontend API
        run: |
          curl -f http://localhost:5173 || (echo "Frontend API test failed" && exit 1)
          echo "Frontend API is working!"
